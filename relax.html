<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no"/>
<title>é•·è€…åœ–æ¡ˆæŒ‘æˆ°ï¼ˆæœ€çµ‚ç‰ˆï¼‰</title>

<style>
:root{
  --bg:#fff8ef;
  --panel:#fffaf0;
  --accent:#ffb877;
  --accent-strong:#ff8c3a;
  --text:#333;
}
html,body{margin:0;padding:0;height:100%;}
body{
  background:var(--bg);
  font-family:"Noto Sans TC", Arial;
  color:var(--text);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:10px;
  -webkit-user-select:none;
  user-select:none;
  touch-action:manipulation;
}

/* å¤§å­— */
h1{ font-size:30px; color:var(--accent-strong); margin:8px 0; }
.lead{ font-size:22px; }

/* æŒ‰éˆ• */
.btn{
  background:var(--accent-strong);
  color:#fff;
  border:none;
  padding:12px 20px;
  border-radius:12px;
  font-size:24px;
  margin:4px;
}
.btn:active{ transform:translateY(2px); }

.container{ width:100%; max-width:900px; }

/* å€å¡Šæ’ç‰ˆ */
.sizeSelect{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center; }

.areaRow{
  margin-top:10px;
  display:flex;
  flex-wrap:wrap;
  gap:20px;
  justify-content:center;
}

.panel{
  background:var(--panel);
  padding:12px;
  border-radius:12px;
  box-shadow:0 3px 0 rgba(0,0,0,0.1);
}

/* ç›®æ¨™ */
.targetGrid{
  display:grid;
  gap:6px;
}
.targetCell{
  width:40px; height:40px;
  background:#fff6e6;
  border:2px solid var(--accent-strong);
  border-radius:6px;
  opacity:0;
  animation: fadeIn 0.4s forwards;
}
.targetCell.on{
  background:var(--accent);
  border-color:var(--accent-strong);
}

@keyframes fadeIn{
  from{ opacity:0; transform:scale(0.6); }
  to{ opacity:1; transform:scale(1); }
}

/* æ£‹ç›¤ */
.boardGrid{
  display:grid;
  gap:6px;
}
.boardCell{
  width:48px; height:48px;
  background:#fff;
  border:3px solid var(--accent-strong);
  border-radius:6px;
  box-sizing:border-box;
  transition:0.1s;
}
.boardCell.filled{
  background:var(--accent);
  transform:scale(1.07);
  box-shadow:0 0 10px rgba(255,140,58,0.6);
}

/* åŠé€æ˜å¼•å°æ¨¡å¼ */
.boardCell.guide{
  background:rgba(255,140,58,0.3);
}

/* è£œçµ¦å–®æ ¼ */
.single{
  width:48px;height:48px;
  background:var(--accent);
  border:3px solid var(--accent-strong);
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  color:#fff;
  font-weight:bold;
}
.single.picked{
  outline:5px solid rgba(255,140,58,0.4);
  transform:scale(1.1);
}

.status{ font-size:20px; margin-top:10px; }
.switchWrap{ font-size:18px; margin-top:6px; }
</style>
</head>


<body>
<div class="container">

<h1>ğŸ§© åœ–æ¡ˆæŒ‘æˆ°ï¼ˆæœ€çµ‚ç‰ˆï¼‰</h1>
<div class="lead">é¸æ£‹ç›¤å¤§å° â†’ å¡«å‡ºä¸€æ¨¡ä¸€æ¨£çš„åœ–æ¡ˆã€‚</div>

<!-- å°ºå¯¸é¸æ“‡ -->
<div class="sizeSelect">
  <button class="btn" id="size5">5Ã—5</button>
  <button class="btn" id="size8">8Ã—8</button>
  <button class="btn" id="size10">10Ã—10</button>
</div>

<!-- èªéŸ³ / å¼•å° -->
<div class="switchWrap">
  <label><input type="checkbox" id="ttsToggle" checked> èªéŸ³å¼•å°</label>
  &nbsp;&nbsp;
  <label><input type="checkbox" id="guideToggle"> åŠé€æ˜å¼•å°æ¨¡å¼</label>
</div>

<div class="areaRow">
  <!-- ç›®æ¨™ -->
  <div class="panel">
    <div style="font-size:22px;margin-bottom:6px;">ç›®æ¨™åœ–æ¡ˆ</div>
    <div id="targetGrid" class="targetGrid"></div>
  </div>

  <!-- æ£‹ç›¤ -->
  <div class="panel">
    <div style="font-size:22px;margin-bottom:6px;">ä½ çš„æ£‹ç›¤</div>
    <div id="boardGrid" class="boardGrid"></div>
    <div style="font-size:16px;margin-top:6px;">é»é¸ä¸‹æ–¹æ–¹å¡Š â†’ é»æ£‹ç›¤æ”¾ç½®</div>
  </div>

  <!-- è£œçµ¦ -->
  <div class="panel">
    <div style="font-size:20px;">è£œçµ¦ï¼ˆå–®æ ¼ï¼‰</div>
    <div id="supply" class="single">ï¼‹</div>
  </div>
</div>

<!-- æ“ä½œ -->
<div style="text-align:center;margin-top:10px;">
  <button class="btn" id="btnReset">é‡è¨­</button>
  <button class="btn" id="btnNext">ä¸‹ä¸€é¡Œ</button>
</div>

<div class="status" id="status">æº–å‚™é–‹å§‹ã€‚</div>

</div>

<script>
/*=====================*
 *  å…¨åŸŸè®Šæ•¸
 *=====================*/
let gridSize=5;
let target=[], board=[];
let supplyPicked=false;

const targetGrid=document.getElementById("targetGrid");
const boardGrid=document.getElementById("boardGrid");
const supply=document.getElementById("supply");
const statusBox=document.getElementById("status");

const guideToggle=document.getElementById("guideToggle");
const ttsToggle=document.getElementById("ttsToggle");

/*=====================*
 *  èªéŸ³
 *=====================*/
function speak(t){
  if(!ttsToggle.checked) return; // è‹¥èªéŸ³é—œé–‰ â†’ ä¸èªªè©±
  const u=new SpeechSynthesisUtterance(t);
  u.lang="zh-TW";
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

/*=====================*
 *  ç”Ÿæˆé€£çºŒåœ–æ¡ˆ
 *=====================*/
function generateTarget(){
  const N=gridSize;
  target=Array.from({length:N},()=>Array(N).fill(0));

  const total=N*N;
  const fillCount=Math.floor(total*0.28);

  let r=Math.floor(N/2), c=Math.floor(N/2);
  target[r][c]=1;

  let used=[[r,c]];

  while(used.length<fillCount){
    const [cr,cc]=used[Math.floor(Math.random()*used.length)];
    const dirs=[[1,0],[-1,0],[0,1],[0,-1]];
    const d=dirs[Math.floor(Math.random()*4)];
    const nr=cr+d[0], nc=cc+d[1];
    if(nr<0||nr>=N||nc<0||nc>=N) continue;
    if(target[nr][nc]===1) continue;
    target[nr][nc]=1;
    used.push([nr,nc]);
  }
}

/*=====================*
 *  å»ºç«‹ DOM
 *=====================*/
function render(){
  // target
  targetGrid.style.gridTemplateColumns=`repeat(${gridSize},40px)`;
  targetGrid.innerHTML="";
  for(let r=0;r<gridSize;r++){
    for(let c=0;c<gridSize;c++){
      const d=document.createElement("div");
      d.className="targetCell"+(target[r][c]?" on":"");
      targetGrid.appendChild(d);
    }
  }

  // board
  board=Array.from({length:gridSize},()=>Array(gridSize).fill(0));
  boardGrid.style.gridTemplateColumns=`repeat(${gridSize},48px)`;
  boardGrid.innerHTML="";
  for(let r=0;r<gridSize;r++){
    for(let c=0;c<gridSize;c++){
      const d=document.createElement("div");
      d.className="boardCell";
      d.dataset.r=r;
      d.dataset.c=c;
      d.addEventListener("click",place);
      boardGrid.appendChild(d);
    }
  }

  if(guideToggle.checked) applyGuide();
}

/*=====================*
 *  åŠé€æ˜å¼•å°
 *=====================*/
function applyGuide(){
  for(let r=0;r<gridSize;r++){
    for(let c=0;c<gridSize;c++){
      const cell=boardGrid.children[r*gridSize+c];
      if(target[r][c]===1 && board[r][c]===0){
        cell.classList.add("guide");
      }
    }
  }
}
function clearGuide(){
  [...boardGrid.children].forEach(c=>c.classList.remove("guide"));
}
guideToggle.addEventListener("change",()=>{
  clearGuide();
  if(guideToggle.checked) applyGuide();
});

/*=====================*
 *  è£œçµ¦é¸å–
 *=====================*/
supply.addEventListener("click",()=>{
  supplyPicked=!supplyPicked;
  supply.classList.toggle("picked",supplyPicked);
  if(supplyPicked) speak("é¸å¥½äº†ï¼Œå¯ä»¥æ”¾ç½®æ–¹å¡Š");
});

/*=====================*
 *  æ”¾ç½®æ–¹å¡Š
 *=====================*/
function place(e){
  if(!supplyPicked){
    speak("è«‹å…ˆé¸ä¸‹æ–¹çš„å–®æ ¼");
    return;
  }

  const r=parseInt(e.currentTarget.dataset.r);
  const c=parseInt(e.currentTarget.dataset.c);

  if(board[r][c]===1){
    speak("é€™æ ¼å·²ç¶“æ”¾éäº†");
    return;
  }

  board[r][c]=1;
  const cell=e.currentTarget;
  cell.classList.add("filled");

  if(guideToggle.checked) cell.classList.remove("guide");

  checkWin();
}

/*=====================*
 *  åˆ¤æ–·æ˜¯å¦å®Œæˆ
 *=====================*/
function checkWin(){
  for(let r=0;r<gridSize;r++){
    for(let c=0;c<gridSize;c++){
      if(target[r][c]!==board[r][c]) return;
    }
  }
  speak("å¤ªæ£’äº†ï¼ä½ å®Œæˆäº†ï¼");
  statusBox.innerText="ğŸ‰ å®Œæˆåœ–æ¡ˆï¼æŒ‰ä¸‹ä¸€é¡Œç¹¼çºŒ";
}

/*=====================*
 *  é‡è¨­ / ä¸‹ä¸€é¡Œ
 *=====================*/
document.getElementById("btnReset").addEventListener("click",()=>{
  clearGuide();
  board.forEach(r=>r.fill(0));
  [...boardGrid.children].forEach(c=>c.classList.remove("filled","guide"));
  supplyPicked=false;
  supply.classList.remove("picked");
  if(guideToggle.checked) applyGuide();
  speak("å·²é‡è¨­");
  statusBox.innerText="å·²é‡è¨­ã€‚";
});

document.getElementById("btnNext").addEventListener("click",()=>{
  generateTarget();
  render();
  supplyPicked=false;
  supply.classList.remove("picked");
  speak("æ–°çš„é¡Œç›®é–‹å§‹");
  statusBox.innerText="æ–°çš„é¡Œç›®é–‹å§‹ï¼";
});

/*=====================*
 *  å°ºå¯¸åˆ‡æ›
 *=====================*/
document.getElementById("size5").onclick=()=>{gridSize=5;generateTarget();render();};
document.getElementById("size8").onclick=()=>{gridSize=8;generateTarget();render();};
document.getElementById("size10").onclick=()=>{gridSize=10;generateTarget();render();};

/*=====================*
 *  åˆå§‹åŒ–
 *=====================*/
generateTarget();
render();
</script>

</body>
</html>
